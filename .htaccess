# Apache Configuration for Osmangazi Suaritma Website
# Security, Performance, and Redirect Rules

# ========================================
# Enable Required Modules
# ========================================
<IfModule mod_rewrite.c>
  RewriteEngine On
</IfModule>

# ========================================
# HTTP to HTTPS Redirect
# ========================================
<IfModule mod_rewrite.c>
  RewriteCond %{HTTPS} off
  RewriteCond %{HTTP:X-Forwarded-Proto} !https
  RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]
</IfModule>

# ========================================
# WWW to Non-WWW Redirect (Optional)
# Uncomment if you want to force non-www URLs
# ========================================
# <IfModule mod_rewrite.c>
#   RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
#   RewriteRule ^(.*)$ https://%1/$1 [R=301,L]
# </IfModule>

# ========================================
# Enable Gzip Compression
# ========================================
<IfModule mod_deflate.c>
  # Compress HTML, CSS, JavaScript, Text, XML, and SVG files
  AddOutputFilterByType DEFLATE text/html
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/xml
  AddOutputFilterByType DEFLATE text/css
  AddOutputFilterByType DEFLATE text/javascript
  AddOutputFilterByType DEFLATE application/xml
  AddOutputFilterByType DEFLATE application/xhtml+xml
  AddOutputFilterByType DEFLATE application/rss+xml
  AddOutputFilterByType DEFLATE application/javascript
  AddOutputFilterByType DEFLATE application/x-javascript
  AddOutputFilterByType DEFLATE application/x-font
  AddOutputFilterByType DEFLATE application/x-font-truetype
  AddOutputFilterByType DEFLATE application/x-font-opentype
  AddOutputFilterByType DEFLATE application/x-font-woff
  AddOutputFilterByType DEFLATE application/x-font-woff2
  AddOutputFilterByType DEFLATE image/svg+xml
  
  # Remove browser bugs (optional)
  BrowserMatch ^Mozilla/4 gzip-only-text/html
  BrowserMatch ^Mozilla/4\.0[678] no-gzip
  BrowserMatch \bMSIE !gzip !gzip-only-text/html
  Header append Vary User-Agent
</IfModule>

# ========================================
# Browser Caching Rules
# ========================================
<IfModule mod_expires.c>
  ExpiresActive On
  
  # Set default expiration time
  ExpiresDefault "access plus 7 days"
  
  # HTML files - cache for 1 day
  ExpiresByType text/html "access plus 1 day"
  
  # CSS and JavaScript - cache for 30 days
  ExpiresByType text/css "access plus 30 days"
  ExpiresByType application/javascript "access plus 30 days"
  ExpiresByType text/javascript "access plus 30 days"
  
  # Images - cache for 1 year
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType image/x-icon "access plus 1 year"
  
  # Fonts - cache for 1 year
  ExpiresByType application/font-woff "access plus 1 year"
  ExpiresByType application/x-font-woff "access plus 1 year"
  ExpiresByType application/x-font-truetype "access plus 1 year"
  ExpiresByType application/x-font-opentype "access plus 1 year"
  ExpiresByType font/opentype "access plus 1 year"
  
  # Videos - cache for 1 month
  ExpiresByType video/mp4 "access plus 1 month"
  ExpiresByType video/webm "access plus 1 month"
</IfModule>

# ========================================
# Security Headers
# ========================================
<IfModule mod_headers.c>
  # Strict-Transport-Security (HSTS)
  # Forces HTTPS connection for 1 year, including subdomains
  Header always set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
  
  # X-Content-Type-Options
  # Prevents MIME-sniffing attacks
  Header always set X-Content-Type-Options "nosniff"
  
  # X-Frame-Options
  # Prevents clickjacking attacks
  Header always set X-Frame-Options "SAMEORIGIN"
  
  # X-XSS-Protection
  # Enables XSS protection in older browsers
  Header always set X-XSS-Protection "1; mode=block"
  
  # Referrer-Policy
  # Controls how much referrer information is shared
  Header always set Referrer-Policy "strict-origin-when-cross-origin"
  
  # Permissions-Policy
  # Controls which features and APIs can be used
  Header always set Permissions-Policy "geolocation=(), microphone=(), camera=(), payment=(), usb=()"
  
  # Content-Security-Policy
  # Helps prevent XSS, clickjacking, and other injection attacks
  # Update 'example.com' with your actual domain
  Header always set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data: https:; connect-src 'self' https:; frame-ancestors 'self'; base-uri 'self'; form-action 'self';"
  
  # Remove Server header for security
  Header always unset Server
  Header always unset X-Powered-By
  Header unset X-Powered-By
</IfModule>

# ========================================
# Disable Directory Browsing
# ========================================
Options -Indexes

# ========================================
# Disable Access to Sensitive Files
# ========================================
<FilesMatch "(?:^#.*#|\.(bak|conf|dist|fla|in[ci]|log|psd|sh|sql|sw[op])|~)$">
  <IfModule mod_authz_core.c>
    Require all denied
  </IfModule>
  <IfModule !mod_authz_core.c>
    Order allow,deny
    Deny from all
  </IfModule>
</FilesMatch>

# ========================================
# Protect Sensitive Files and Directories
# ========================================
<FilesMatch "^\.(env|htaccess|htpasswd)$">
  <IfModule mod_authz_core.c>
    Require all denied
  </IfModule>
  <IfModule !mod_authz_core.c>
    Order allow,deny
    Deny from all
  </IfModule>
</FilesMatch>

# ========================================
# Block Access to wp-config.php, composer files, etc.
# ========================================
<Files "wp-config.php">
  <IfModule mod_authz_core.c>
    Require all denied
  </IfModule>
</Files>

<Files "composer.json">
  <IfModule mod_authz_core.c>
    Require all denied
  </IfModule>
</Files>

# ========================================
# Set Proper MIME Types
# ========================================
<IfModule mod_mime.c>
  AddType application/javascript js
  AddType application/json json
  AddType image/webp webp
  AddType font/woff woff
  AddType font/woff2 woff2
  AddCharset UTF-8 .html .css .js .xml .json .rss .atom
</IfModule>

# ========================================
# Prevent Access to .git Directory
# ========================================
<DirectoryMatch "^.*\.git">
  <IfModule mod_authz_core.c>
    Require all denied
  </IfModule>
  <IfModule !mod_authz_core.c>
    Order allow,deny
    Deny from all
  </IfModule>
</DirectoryMatch>

# ========================================
# Pretty URLs (URL Rewriting)
# Uncomment and modify based on your framework
# ========================================
# <IfModule mod_rewrite.c>
#   RewriteBase /
#   RewriteCond %{REQUEST_FILENAME} !-f
#   RewriteCond %{REQUEST_FILENAME} !-d
#   RewriteRule ^(.*)$ index.php?/$1 [QSA,L]
# </IfModule>
